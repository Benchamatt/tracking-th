function toThaiStatus(raw){
  const t0 = (raw || "").trim();
  if(!t0) return "";

  const t = t0.replace(/\s+/g, " ").trim();

  const rules = [
    { key: "您已下單成功", th: "สร้างออเดอร์การจัดส่งเรียบร้อย" },
    { key: "倉庫同事已揀貸 等待打印地址面單", th: "แพ็คกิ้งพัสดุเรียบร้อยแล้ว" },
    { key: "您的貨物已准備從集運倉出倉", th: "พัสดุของคุณออกคลัง เพื่อเตรียมส่งไปยังสนามบินแล้ว" },
    { key: "連線收單建檔", th: "ระบบศุลกากรรับและบันทึกข้อมูลเรียบร้อยแล้ว" },

    { key: "出倉處理", th: "กำลังดำเนินการนำสินค้าออกจากคลัง" },
    { key: "轉運中-轉運中>已集貸>北三特服二所", th: "อยู่ระหว่างการขนส่งไปยังศูนย์ย่อย(สาขาปลายทาง)" },
    { key: "已集貨>北三特販二所>SD已經至寄件人指定地點收到包裹", th: "พัสดุอยู่ศูนย์คัดแยกพัสดุ" },

    { key: "貨物在目的地國家海關清關中", th: "พัสดุอยู่ระหว่างการเดินพิธีการศุลกากรในประเทศปลายทาง" },
    { key: "通關方式C1", th: "พิธีการศุลกากรแบบ C1" },
    { key: "通關方式C3", th: "พิธีการศุลกากรแบบ C3" },
    { key: "通關方式C2", th: "พิธีการศุลกากรแบบ C2" },
    { key: "放行", th: "พัสดุผ่านพิธีการศุลกากรเรียบร้อยแล้ว" },

    { key: "不受理不可補正之錯單", th: "ข้อมูลที่ใช้เดินพิธีการไม่สอดคล้องกัน โปรดติดต่อเจ้าหน้าที่" },
    {
      key: "由於海關系統查無此包裹申報人資料，請確認申報人是否已註冊過EZ WAY。 若尚未註冊，請於完成註冊後，至個人資料維護介面截圖申報人名、電話號碼及身分證號，並提交給威名客服，海關受理資料後約1~2個工作天放行。",
      th: "เนื่องจากระบบศุลกากรไม่พบข้อมูลผู้เดินพิธีการ โปรดตรวจสอบว่าผู้รับพัสดุได้ลงทะเบียนกับ EZ WAY แล้วหรือไม่ หากยังไม่ได้ลงทะเบียนโปรดลงทะเบียนให้เรียบร้อย ถ่ายภาพหน้าจอให้ติดชื่อ/หมายเลขโทรศัพท์และหมายเลขบัตรประชาชนของผู้เดินพิธีการ แล้วส่งให้เจ้าหน้าที่ลูกค้าสัมพันธ์ของ Weiming หลังจากได้รับข้อมูลแล้ว พัสดุจะได้รับการปล่อยภายในประมาณ 1-2 วันทำการ"
    },

    { key: "配送中-配送中>白河營業所", th: "อยู่ระหว่างการจัดส่ง" },
    { key: "配送中>白河營業所>SD正在將包裹配送到收件人途中", th: "อยู่ระหว่างการจัดส่ง" },

    { key: "暫置營業所,暫置營業所>暫置保管中国联络络黑猫宅急便412-8888)>白河營業所", th: "พัสดุถูกพักไว้ชั่วคราวที่สาขา" },
    { key: "公司行號休息-公司行號休息>白河營業所", th: "จัดส่งไม่สำเร็จเนื่องจากบริษัทหยุดทำการ" },

    { key: "配完-配完>順利送達>白河營業所", th: "พัสดุถึงผู้รับเรียบร้อยแล้ว" },
    { key: "順利送達>白河營業所>包裹已經送達收件人", th: "จัดส่งสำเร็จ" },

    { key: "สั่งซื้อสำเร็จ", th: "พัสดุผู้ส่งได้รับแล้ว  รอการดำเนินการจากคลังสินค้า" },
    { key: "รอคลังสินค้าดำเนินการ", th: "พัสดุผู้ส่งได้รับแล้ว  รอการดำเนินการจากคลังสินค้า" },
  ];

  // ท้าย override หน้า
  let out = "";
  for(const r of rules){
    if(t.includes(r.key)) out = r.th;
  }

  // ✅ ไม่ match = ไม่แสดง
  return out;
}

function mapAllEvents(rawEvents){
  if(!Array.isArray(rawEvents)) return [];

  const seen = new Set();
  const out = [];

  for (const e of rawEvents){
    const raw = e.status_th || e.status || e.latest_status_th || "";
    const th = toThaiStatus(raw);

    // ✅ ไม่ match => ไม่แสดง
    if(!th) continue;

    const time = (e.time || "").trim() || "-";
    const key = `${time}||${th}`;

    // ✅ กันซ้ำจริง ๆ (เวลา+ข้อความ)
    if(seen.has(key)) continue;
    seen.add(key);

    out.push({ ...e, _th: th });
  }

  return out;
}
